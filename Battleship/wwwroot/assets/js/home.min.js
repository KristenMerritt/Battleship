function initializeUserHandle(){var n=getTokenFromCookie();n!==""&&n!==null&&getUserHandleFromToken(n)}function initializeSendMessageEvent(){var n=getTokenFromCookie();$("#chat-form").on("submit",function(t){if(t.preventDefault(),n!==""&&n!==null)if(validToken(n)){var i=$("input[name='chat-message']").val(),r={Message:i,Token:n};ajax("POST",!0,"api/Chat",r,function(){})}else alert("Invalid user login - please log in again.")})}function getAllChat(){ajax("GET",!0,"api/Chat",null,function(n){$.each(n,function(n,t){insertNewChat(t)})})}function getMostRecentChat(){var n=$("#last-chat-id").val();ajax("GET",!0,"api/Chat/"+n,null,function(n){$.each(n,function(n,t){insertNewChat(t)})})}function insertNewChat(n){var r=document.createElement("div"),t,u,i,f,e;r.setAttribute("class","chat-item");t=document.createElement("p");t.setAttribute("class","chat-text");u=document.createTextNode(n.message);i=document.createElement("span");i.setAttribute("class","chat-name");f=getUserHandle(n.player_Id);e=document.createTextNode(f+": ");i.appendChild(e);t.appendChild(i);t.appendChild(u);r.appendChild(t);$("#chat-container").append(r);$("#last-chat-id").val(n.chat_Id)}function initializeChallengeEvent(){$("#challenge-request").on("submit",function(n){var t;if(n.preventDefault(),t=getTokenFromCookie(),t!==""&&t!==null&&validToken(t)){var r=$("#challenge-handle").val(),u=getUserIdFromToken(t),i=getUserIdFromHandle(r,t);i!==-1&&ajax("POST",!0,"api/Challenge/new/"+u+"/"+i+"/"+t,null,function(n){n.errMsg!=null?sendErrorMessage(n):alert("Challenge sent!")})}})}function checkForChallenges(n,t){ajax("GET",!0,"api/Challenge/"+n+"/"+t,null,function(n){n.errMsg!=null?sendErrorMessage(n):$.each(n,function(n,t){insertNewChallenge(t)})})}function checkForNewChallenges(n,t){console.log("Checking for new challenges...");var i=$("#last-challenge-id").val();ajax("GET",!0,"api/Challenge/checkNew/"+n+"/"+i+"/"+t,null,function(n){n.errMsg!=null?sendErrorMessage(n):$.each(n,function(n,t){insertNewChallenge(t)})})}function insertNewChallenge(n){var t=document.createElement("div"),i,e,r,h,u,c,f,l;t.setAttribute("class","challenge");t.setAttribute("id","challenge_"+n.challenge_Id);i=document.createElement("div");i.setAttribute("class","challenge-info");e=document.createElement("p");e.setAttribute("class","challenger-name");var o=n.player_1,s=n.player_2,a=getUserHandle(o),v=getUserHandle(s),y=document.createTextNode(a+" vs "+v);e.appendChild(y);i.appendChild(e);n.accepted?(r=document.createElement("div"),r.setAttribute("class","challenge-accept-button"),r.setAttribute("onclick","window.location.href='/game?p1="+o+"&p2="+s+"'"),h=document.createTextNode("View Game"),r.appendChild(h),t.appendChild(i),t.appendChild(r)):(u=document.createElement("div"),u.setAttribute("class","challenge-accept-button"),c=document.createTextNode("Accept"),u.appendChild(c),u.setAttribute("onclick","respondToChallenge("+n.challenge_Id+",true)"),f=document.createElement("div"),f.setAttribute("class","challenge-decline-button"),l=document.createTextNode("Decline"),f.appendChild(l),f.setAttribute("onclick","respondToChallenge("+n.challenge_Id+",false)"),t.appendChild(i),t.appendChild(u),t.appendChild(f));$("#challenge-container").append(t);$("#last-challenge-id").val(n.challenge_Id)}function respondToChallenge(n,t){var i=getTokenFromCookie();i!==""&&i!==null&&validToken(i)&&ajax("POST",!0,"api/Challenge/set-status/"+n+"/"+t+"/"+i,null,function(n){n.errMsg!=null?sendErrorMessage(n):n.accepted?(makeGameComponents(n,i),$("#challenge_"+n.challenge_Id).remove(),insertNewChallenge(n)):$("#challenge_"+n.challenge_Id).remove()})}function getGame(n,t,i){console.log("Retrieving game data...");var r;return ajax("GET",!1,"api/Game/"+n+"/"+t+"/"+i,null,function(n){n.errMsg!=null?sendErrorMessage(n):r=n}),r}function getBoard(n){var t;return ajax("GET",!1,"api/Board/"+n+"/"+cookie,null,function(n){n.errMsg!=null?sendErrorMessage(n):t=n}),t}function makeGameComponents(n,t){var r=n.player_1,u=n.player_2,i=getGame(r,u,t);makeStarterShips(i.player_1_Board_Id);makeStarterShips(i.player_2_Board_Id)}function makeStarterShips(n){ajax("POST",!0,"api/Ship/starter/"+n,null,function(t){t?makeStarterShipLocations(n):alert("Error making ships for new board.")})}function makeStarterShipLocations(n){var r,t,i,f;for(ajax("GET",!1,"api/Ship/all-by-board/"+n,null,function(n){r=n}),t=0;t<r.length;t++){var u=r[t],e=u.ship_Type_Id,o=getShipLength(e);for(i=0;i<o;i++)f={Ship_Location_Id:-1,Ship_Id:u.ship_Id,Board_Id:n,Row:t,Col:i},ajax("POST",!0,"api/ShipLocation/createLocation",f,function(n){n||console.log("Error making location.")})}}function getShipLength(n){var t=-1;return ajax("GET",!1,"api/ShipType/"+n,null,function(n){t=n.ship_Length}),t}$(document).ready(function(){initializeUserHandle();initializeSendMessageEvent();getAllChat();window.setInterval(function(){getMostRecentChat()},1e3)});$(document).ready(function(){initializeChallengeEvent();var t=-1,n=getTokenFromCookie();n!==""&&n!==null&&validToken(n)&&(t=getUserIdFromToken(n),checkForChallenges(t,n));t!==-1&&window.setInterval(function(){checkForNewChallenges(t,n)},2e3)});